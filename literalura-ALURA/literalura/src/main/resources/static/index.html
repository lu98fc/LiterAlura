<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>LiterAlura</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans&display=swap');
        body {
          margin: 0;
          font-family: 'Open Sans', sans-serif;
          background: url('tu-imagen.png') no-repeat center center fixed;
          background-size: cover;
          color: #fff;
        }
        .overlay {
          background-color: rgba(30,30,30,0.85);
          min-height: 100vh;
          padding: 2rem;
        }
        h1 {
          text-align: center;
          font-size: 2.5rem;
          margin-bottom: 2rem;
        }
        .search-bar {
          display: flex;
          justify-content: center;
          margin-bottom: 2rem;
        }
        .search-bar input {
          width: 60%;
          padding: 0.8rem;
          border: none;
          border-radius: 8px;
          font-size: 1rem;
        }
        .menu {
          display: flex;
          flex-direction: column;
          gap: 1rem;
          max-width: 600px;
          margin: auto;
        }
        .menu button {
          display: flex;
          align-items: center;
          background-color: rgba(255,255,255,0.2);
          border: none;
          padding: 1rem;
          border-radius: 10px;
          box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
          font-size: 1rem;
          font-weight: bold;
          color: #fff;
          cursor: pointer;
        }
        .menu button:hover {
          background-color: rgba(255,255,255,0.35);
        }
        .menu i {
          margin-right: 1rem;
          font-size: 1.2rem;
          color: #fafafa;
        }
        #resultados {
          margin-top: 2rem;
          max-width: 800px;
          margin-inline: auto;
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }
        .card {
          background-color: rgba(255,255,255,0.1);
          padding: 1rem;
          border-radius: 8px;
          color: #fff;
        }
    </style>
</head>
<body>
<div class="overlay">
    <h1>LiterAlura</h1>
    <div class="search-bar">
        <input type="text" id="busquedaInput" placeholder="Buscar por t√≠tulo o autor" />
    </div>
    <div class="menu">
        <button onclick="listarLibrosGuardados()">üìò Listar libros guardados</button>
        <button onclick="listarAutoresGuardados()">üë§ Listar autores guardados</button>
        <button onclick="autoresVivosEnAnio()">üìÖ Autores vivos en a√±o</button>
        <button onclick="listarLibrosPorIdioma()">üåê Libros por idioma</button>
        <button onclick="estadisticasDescargas()">üìä Estad√≠sticas de descargas</button>
        <button onclick="top10Descargados()">‚≠ê Top 10 m√°s descargados</button>
        <button onclick="buscarAutorPorNombre()">üîç Buscar autor por nombre</button>
        <button onclick="vaciarTodo()">üóëÔ∏è Vaciar todo</button>
    </div>
    <div id="resultados"></div>
</div>

<script>
    // Script integrado - ahora funcionar√°
    console.log("Script cargado correctamente");

    const apiBase = 'https://gutendex.com/books';
const apiBackup = 'https://www.gutendex.com/books'; // URL
    window.librosBuscados = [];

    document.addEventListener('DOMContentLoaded', function() {
        console.log("DOM cargado");

        const input = document.getElementById('busquedaInput');

        if (input) {
            console.log("Input encontrado");
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    console.log("Enter presionado");
                    buscarLibros();
                }
            });
        } else {
            console.log("Input NO encontrado");
        }
    });

    async function buscarLibros() {
        const input = document.getElementById('busquedaInput');
        const query = input.value.trim();

        console.log("Buscando:", query);

        if (!query) {
            alert("Por favor ingresa un t√©rmino de b√∫squeda");
            return;
        }

        const container = document.getElementById('resultados');
        container.innerHTML = '<div class="card">üîç Buscando...</div>';

        // Lista de URLs para probar
        const urls = [
            `${apiBase}?search=${encodeURIComponent(query)}`,
            `${apiBackup}?search=${encodeURIComponent(query)}`,
            `https://gutendx.com/books/?search=${encodeURIComponent(query)}`
        ];

        for (let i = 0; i < urls.length; i++) {
            try {
                const url = urls[i];
                console.log(`Intentando URL ${i + 1}:`, url);

                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log("Datos recibidos:", data);

                container.innerHTML = '';
                window.librosBuscados = [];

                if (!data.results || data.results.length === 0) {
                    container.innerHTML = '<div class="card">‚ùå No se encontraron resultados para tu b√∫squeda</div>';
                    return;
                }

                data.results.slice(0, 10).forEach((libro, index) => {
                    const libroData = {
                        titulo: libro.title || 'Sin t√≠tulo',
                        autor: libro.authors?.[0]?.name || 'Autor desconocido',
                        idioma: libro.languages || ['unknown'],
                        descargas: libro.download_count || 0,
                        birth_year: libro.authors?.[0]?.birth_year || null,
                        death_year: libro.authors?.[0]?.death_year || null
                    };

                    window.librosBuscados.push(libroData);

                    const div = document.createElement('div');
                    div.className = 'card';
                    div.innerHTML = `
                        <strong>${libroData.titulo}</strong><br>
                        Autor: ${libroData.autor}<br>
                        Idioma: ${libroData.idioma.join(', ')}<br>
                        Descargas: ${libroData.descargas}<br><br>
                        <button onclick="guardarLibro(${index})" style="background: #4CAF50; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">üíæ Guardar</button>
                    `;
                    container.appendChild(div);
                });

                // Si llegamos aqu√≠, la b√∫squeda fue exitosa
                return;

            } catch (error) {
                console.error(`Error con URL ${i + 1}:`, error);

                // Si es la √∫ltima URL y fall√≥, mostrar error
                if (i === urls.length - 1) {
                    container.innerHTML = `
                        <div class="card">
                            ‚ùå Error de conexi√≥n<br>
                            Verifica tu conexi√≥n a internet o intenta m√°s tarde.<br><br>
                            <strong>Posibles soluciones:</strong><br>
                            ‚Ä¢ Verifica tu conexi√≥n a internet<br>
                            ‚Ä¢ Intenta con una b√∫squeda diferente<br>
                            ‚Ä¢ Recarga la p√°gina e intenta de nuevo
                        </div>
                    `;
                }
            }
        }
    }

    function obtenerLibros() {
        try {
            return JSON.parse(localStorage.getItem('libros')) || [];
        } catch (error) {
            console.error('Error leyendo localStorage:', error);
            return [];
        }
    }

    function guardarLibro(index) {
        console.log("Guardando libro √≠ndice:", index);

        if (!window.librosBuscados || !window.librosBuscados[index]) {
            alert('‚ùå Error: libro no encontrado');
            return;
        }

        const libro = window.librosBuscados[index];
        const libros = obtenerLibros();

        // Verificar si ya existe
        const existe = libros.some(l => l.titulo === libro.titulo && l.autor === libro.autor);

        if (existe) {
            alert('‚ö†Ô∏è Este libro ya est√° guardado');
            return;
        }

        libros.push(libro);
        localStorage.setItem('libros', JSON.stringify(libros));
        alert('üíæ Libro guardado correctamente');
    }

    function listarLibrosGuardados() {
        console.log("Listando libros guardados");
        const libros = obtenerLibros();
        const container = document.getElementById('resultados');

        if (libros.length === 0) {
            container.innerHTML = '<div class="card">üìö No tienes libros guardados. Busca y guarda algunos libros primero.</div>';
            return;
        }

        container.innerHTML = '';
        libros.forEach(libro => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <strong>${libro.titulo}</strong><br>
                Autor: ${libro.autor}<br>
                Idioma: ${libro.idioma.join(', ')}<br>
                Descargas: ${libro.descargas.toLocaleString()}
            `;
            container.appendChild(div);
        });
    }

    function listarAutoresGuardados() {
        console.log("Listando autores guardados");
        const libros = obtenerLibros();
        const container = document.getElementById('resultados');

        if (libros.length === 0) {
            container.innerHTML = '<div class="card">üë§ No tienes autores guardados. Busca y guarda algunos libros primero.</div>';
            return;
        }

        const autores = [...new Set(libros.map(libro => libro.autor))];
        container.innerHTML = '';

        autores.forEach(autor => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `üë§ <strong>${autor}</strong>`;
            container.appendChild(div);
        });
    }

    function autoresVivosEnAnio() {
        console.log("Consultando autores vivos");
        const libros = obtenerLibros();

        if (libros.length === 0) {
            alert('‚ùå No tienes libros guardados para consultar');
            return;
        }

        const a√±o = prompt('üìÖ Ingresa el a√±o para consultar autores vivos:');
        if (!a√±o || isNaN(a√±o)) {
            alert('‚ùå Por favor ingresa un a√±o v√°lido');
            return;
        }

        const a√±oNum = parseInt(a√±o);
        const container = document.getElementById('resultados');

        const autoresVivos = libros.filter(libro =>
            libro.birth_year &&
            libro.birth_year <= a√±oNum &&
            (!libro.death_year || libro.death_year >= a√±oNum)
        );

        if (autoresVivos.length === 0) {
            container.innerHTML = `<div class="card">‚ùå No se encontraron autores vivos en el a√±o ${a√±o}</div>`;
            return;
        }

        // Eliminar duplicados
        const autoresUnicos = [];
        const nombresVistos = new Set();

        autoresVivos.forEach(libro => {
            if (!nombresVistos.has(libro.autor)) {
                nombresVistos.add(libro.autor);
                autoresUnicos.push(libro);
            }
        });

        container.innerHTML = '';
        autoresUnicos.forEach(libro => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                üë§ <strong>${libro.autor}</strong><br>
                Estaba vivo en ${a√±o}<br>
                Nacimiento: ${libro.birth_year}<br>
                ${libro.death_year ? `Muerte: ${libro.death_year}` : 'Sin informaci√≥n de muerte'}
            `;
            container.appendChild(div);
        });
    }

    function listarLibrosPorIdioma() {
        console.log("Filtrando por idioma");
        const libros = obtenerLibros();

        if (libros.length === 0) {
            alert('‚ùå No tienes libros guardados para filtrar');
            return;
        }

        const idioma = prompt('üåê Ingresa el c√≥digo de idioma (es, en, pt, fr...)');
        if (!idioma) return;

        const filtrados = libros.filter(libro =>
            libro.idioma.includes(idioma.toLowerCase())
        );

        const container = document.getElementById('resultados');

        if (filtrados.length === 0) {
            container.innerHTML = `<div class="card">‚ùå No tienes libros en idioma "${idioma}"</div>`;
            return;
        }

        container.innerHTML = '';
        filtrados.forEach(libro => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <strong>${libro.titulo}</strong><br>
                Autor: ${libro.autor}<br>
                Idioma: ${libro.idioma.join(', ')}<br>
                Descargas: ${libro.descargas.toLocaleString()}
            `;
            container.appendChild(div);
        });
    }

    function estadisticasDescargas() {
        console.log("Mostrando estad√≠sticas");
        const libros = obtenerLibros();
        const container = document.getElementById('resultados');

        if (libros.length === 0) {
            container.innerHTML = '<div class="card">üìä No tienes libros guardados para mostrar estad√≠sticas</div>';
            return;
        }

        const total = libros.reduce((sum, l) => sum + (l.descargas || 0), 0);
        const promedio = (total / libros.length).toFixed(2);
        const maximo = Math.max(...libros.map(l => l.descargas || 0));
        const minimo = Math.min(...libros.map(l => l.descargas || 0));

        container.innerHTML = `
            <div class="card">
                <strong>üìä Estad√≠sticas de Descargas</strong><br><br>
                üìö Total de libros: ${libros.length}<br>
                üìà Total descargas: ${total.toLocaleString()}<br>
                üìä Promedio: ${Number(promedio).toLocaleString()}<br>
                üî• M√°ximo: ${maximo.toLocaleString()}<br>
                üìâ M√≠nimo: ${minimo.toLocaleString()}
            </div>
        `;
    }

    function top10Descargados() {
        console.log("Mostrando top 10");
        const libros = obtenerLibros();
        const container = document.getElementById('resultados');

        if (libros.length === 0) {
            container.innerHTML = '<div class="card">üìö No tienes libros guardados</div>';
            return;
        }

        const top10 = libros
            .sort((a, b) => (b.descargas || 0) - (a.descargas || 0))
            .slice(0, 10);

        container.innerHTML = '<div class="card"><strong>‚≠ê Top 10 M√°s Descargados</strong></div>';

        top10.forEach((libro, index) => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <strong>#${index + 1} - ${libro.titulo}</strong><br>
                Autor: ${libro.autor}<br>
                Descargas: ${libro.descargas.toLocaleString()}
            `;
            container.appendChild(div);
        });
    }

    function buscarAutorPorNombre() {
        console.log("Buscando autor por nombre");
        const nombre = prompt('üîç Nombre del autor a buscar:');
        if (!nombre) return;

        buscarAutorEnAPI(nombre.trim());
    }

    async function buscarAutorEnAPI(nombreAutor) {
        const container = document.getElementById('resultados');
        container.innerHTML = '<div class="card">üîç Buscando autor...</div>';

        // Lista de URLs para probar
        const urls = [
            `${apiBase}?search=${encodeURIComponent(nombreAutor)}`,
            `${apiBackup}?search=${encodeURIComponent(nombreAutor)}`,
            `https://gutendx.com/books/?search=${encodeURIComponent(nombreAutor)}`
        ];

        for (let i = 0; i < urls.length; i++) {
            try {
                const url = urls[i];
                console.log(`Buscando autor con URL ${i + 1}:`, url);

                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                if (!data.results || data.results.length === 0) {
                    container.innerHTML = '<div class="card">‚ùå No se encontraron libros de este autor</div>';
                    return;
                }

                const librosFiltrados = data.results.filter(libro =>
                    libro.authors && libro.authors.some(autor =>
                        autor.name.toLowerCase().includes(nombreAutor.toLowerCase())
                    )
                );

                if (librosFiltrados.length === 0) {
                    container.innerHTML = '<div class="card">‚ùå No se encontr√≥ este autor espec√≠fico</div>';
                    return;
                }

                container.innerHTML = `<div class="card"><strong>üîç Resultados para "${nombreAutor}"</strong></div>`;
                window.librosBuscados = [];

                librosFiltrados.slice(0, 10).forEach((libro, index) => {
                    const libroData = {
                        titulo: libro.title || 'Sin t√≠tulo',
                        autor: libro.authors?.[0]?.name || 'Autor desconocido',
                        idioma: libro.languages || ['unknown'],
                        descargas: libro.download_count || 0,
                        birth_year: libro.authors?.[0]?.birth_year || null,
                        death_year: libro.authors?.[0]?.death_year || null
                    };

                    window.librosBuscados.push(libroData);

                    const div = document.createElement('div');
                    div.className = 'card';
                    div.innerHTML = `
                        <strong>${libroData.titulo}</strong><br>
                        Autor: ${libroData.autor}<br>
                        Idioma: ${libroData.idioma.join(', ')}<br>
                        Descargas: ${libroData.descargas.toLocaleString()}<br><br>
                        <button onclick="guardarLibro(${index})" style="background: #4CAF50; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">üíæ Guardar</button>
                    `;
                    container.appendChild(div);
                });

                // Si llegamos aqu√≠, la b√∫squeda fue exitosa
                return;

            } catch (error) {
                console.error(`Error buscando autor con URL ${i + 1}:`, error);

                // Si es la √∫ltima URL y fall√≥, mostrar error
                if (i === urls.length - 1) {
                    container.innerHTML = `
                        <div class="card">
                            ‚ùå Error al buscar autor<br>
                            Verifica tu conexi√≥n a internet o intenta m√°s tarde.<br><br>
                            <strong>Posibles soluciones:</strong><br>
                            ‚Ä¢ Verifica tu conexi√≥n a internet<br>
                            ‚Ä¢ Intenta con otro nombre de autor<br>
                            ‚Ä¢ Recarga la p√°gina e intenta de nuevo
                        </div>
                    `;
                }
            }
        }
    }

    function vaciarTodo() {
        console.log("Vaciando todo");
        const libros = obtenerLibros();

        if (libros.length === 0) {
            alert('‚ùå No tienes libros guardados para eliminar');
            return;
        }

        if (confirm('üóëÔ∏è ¬øEliminar todos los libros guardados?')) {
            localStorage.removeItem('libros');
            document.getElementById('resultados').innerHTML = '<div class="card">üóëÔ∏è Todos los libros eliminados</div>';
            alert('‚úÖ Libros eliminados correctamente');
        }
    }
</script>
</body>
</html>